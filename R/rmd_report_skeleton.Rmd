---
title: "scPipe_atac report"
author: ""
date: "`r Sys.Date()`"
output: html_document
params:  
  log_and_stats_folder: folder
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(dplyr)
library(readr)
library(ggplot2)
library(knitr)
library(stringr)
theme_set(theme_bw())

```

## Global quality statistics

```{r}
trimbarcode_stats_filename    <- paste0(params$log_and_stats_folder, "/stats_file_trimbarcode.txt")
trimbarcode_stats             <- readr::read_csv(trimbarcode_stats_filename, col_names = FALSE) %>% as.data.frame() 
trimbarcode_stats             <- stringr::str_replace_all(trimbarcode_stats[,1], "\\: +", "\\,") %>% as.data.frame()
trimbarcode_stats             <- stringr::str_split_fixed(trimbarcode_stats[,1], ",", n=2) %>%
  as.data.frame()

knitr::kable(trimbarcode_stats, 
             col.names = c('Statistic', 'Value'), 
             caption = "Global quality statistics")
```

## Alignment statistics

```{r}
alignment_stats_filename <- paste0(params$log_and_stats_folder, "/stats_file_align.txt")
alignment_stats          <- readr::read_csv(alignment_stats_filename)
knitr::kable(alignment_stats, 
             col.names = c('Statistic', 'Value'), 
             caption = "Global alignment statistics")
```

## Alignment statistics per chromosome

```{r}
alignment_stats_chrom_filename <- paste0(params$log_and_stats_folder, "/stats_file_align_per_chrom.csv")
alignment_stats_chrom          <- readr::read_csv(alignment_stats_chrom_filename)
knitr::kable(alignment_stats_chrom, 
             col.names = c('Chromosome', 'Chrom_length', 'Mapped_reads', "Unmapped_reads"), 
             caption = "Chromosome level alignment statistics")
```

## Read count distribution across barcodes

```{r}

n_reads_barcode_filename    <- paste0(params$log_and_stats_folder, "/number_of_reads_per_barcode.csv")
number_of_reads_per_barcode <- readr::read_csv(n_reads_barcode_filename)

head(number_of_reads_per_barcode)

```

```{r}
number_of_reads_per_barcode %>% 
  ggplot() +
  geom_histogram(aes(log2(number_of_reads))) + theme_bw()
```

